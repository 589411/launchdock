---
/**
 * LearningPath â€” é¦–é å…¥é–€è·¯ç·šå€å¡Š
 * é¡¯ç¤º 6 æ­¥ä¸»ç·šå­¸ç¿’è·¯ç·šï¼Œå·²æœ‰æ–‡ç« çš„æ­¥é©Ÿå¯é€£çµï¼Œç¼ºçš„æ­¥é©Ÿé¡¯ç¤ºã€Œå³å°‡æ¨å‡ºã€
 */
import { getCollection } from 'astro:content';

const allArticles = await getCollection('articles', ({ data }) => !data.archived);

// Build a map: pathStep â†’ article
const stepArticleMap = new Map<number, typeof allArticles[0]>();
for (const article of allArticles) {
  if (article.data.pathStep) {
    stepArticleMap.set(article.data.pathStep, article);
  }
}

const steps = [
  { step: 1, icon: 'ğŸ§­', title: 'èªè­˜ OpenClaw', desc: 'äº†è§£å®ƒèƒ½å¹«ä½ åšä»€éº¼', time: '5 åˆ†é˜' },
  { step: 2, icon: 'ğŸ§ ', title: 'é¸æ“‡ä½ çš„ AI å¤§è…¦', desc: 'LLM æ–¹æ¡ˆæ¯”è¼ƒèˆ‡æ¨è–¦', time: '8 åˆ†é˜' },
  { step: 3, icon: 'ğŸ”‘', title: 'ç”³è«‹ API Key', desc: 'æ‹¿åˆ°è®“ AI é‹ä½œçš„é‘°åŒ™', time: '10 åˆ†é˜' },
  { step: 4, icon: 'ğŸ’»', title: 'å®‰è£ OpenClaw', desc: 'é¸æ“‡ä½ çš„å¹³å°ï¼Œé–‹å§‹å®‰è£', time: '15 åˆ†é˜' },
  { step: 5, icon: 'ğŸš€', title: 'ç¬¬ä¸€æ¬¡å•Ÿå‹•', desc: 'è¨­å®š Keyã€è½åˆ° AI çš„ç¬¬ä¸€å¥è©±', time: '10 åˆ†é˜' },
  { step: 6, icon: 'âš¡', title: 'ç¬¬ä¸€å€‹ Skill', desc: 'å®Œæˆä½ çš„ç¬¬ä¸€å€‹è‡ªå‹•åŒ–ä»»å‹™', time: '10 åˆ†é˜' },
];
---

<section class="max-w-6xl mx-auto px-4 py-16">
  <div class="text-center mb-10">
    <span class="text-sm font-medium text-brand-light tracking-wide uppercase">æ–°æ‰‹å…¥é–€è·¯ç·š</span>
    <h2 class="text-2xl md:text-3xl font-bold mt-2">å¾é›¶é–‹å§‹ï¼Œ6 æ­¥ä¸Šæ‰‹</h2>
    <p class="text-text-secondary mt-2 max-w-lg mx-auto">
      æ¯ä¸€æ­¥éƒ½æœ‰å¯æ“ä½œçš„ç”¢å‡ºï¼Œè·Ÿè‘—èµ°å°±å°äº†ã€‚
    </p>
  </div>

  <!-- Progress line + steps -->
  <div class="learning-path-container">
    {steps.map((s, i) => {
      const article = stepArticleMap.get(s.step);
      const available = !!article;
      const href = available ? `/articles/${article.id}` : undefined;
      const isLast = i === steps.length - 1;

      return (
        <div class="learning-path-step">
          {/* Connector line (except last) */}
          {!isLast && (
            <div class={`learning-path-line ${available && stepArticleMap.has(s.step + 1) ? 'active' : ''}`} />
          )}

          {/* Step node */}
          {available ? (
            <a href={href} class="learning-path-node available group">
              <div class="learning-path-icon">{s.icon}</div>
              <div class="learning-path-number">{s.step}</div>
              <div class="learning-path-content">
                <h3 class="font-semibold group-hover:text-brand-light transition-colors">{s.title}</h3>
                <p class="text-text-muted text-sm">{s.desc}</p>
                <span class="text-xs text-text-muted mt-1 inline-block">â± {s.time}</span>
              </div>
              <span class="learning-path-arrow group-hover:text-brand-light transition-colors">â†’</span>
            </a>
          ) : (
            <div class="learning-path-node upcoming">
              <div class="learning-path-icon dimmed">{s.icon}</div>
              <div class="learning-path-number">{s.step}</div>
              <div class="learning-path-content">
                <h3 class="font-semibold text-text-muted">{s.title}</h3>
                <p class="text-text-muted text-sm">{s.desc}</p>
                <span class="text-xs text-brand-light/60 mt-1 inline-block">ğŸ“ å³å°‡æ¨å‡º</span>
              </div>
            </div>
          )}
        </div>
      );
    })}
  </div>
</section>
