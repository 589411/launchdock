---
/**
 * ArticleProgressBar â€” æ–‡ç« é ‚éƒ¨çš„ä¸»ç·šå­¸ç¿’é€²åº¦æ¢
 * åªåœ¨ pathStep å­˜åœ¨çš„æ–‡ç« ä¸­é¡¯ç¤º
 */
import { getCollection } from 'astro:content';

interface Props {
  currentStep: number;
}

const { currentStep } = Astro.props;

const allArticles = await getCollection('articles', ({ data }) => !data.archived && !!data.pathStep);

// Build step map
const stepArticleMap = new Map<number, typeof allArticles[0]>();
for (const article of allArticles) {
  if (article.data.pathStep) {
    stepArticleMap.set(article.data.pathStep, article);
  }
}

const steps = [
  { step: 1, label: 'èªè­˜' },
  { step: 2, label: 'LLM' },
  { step: 3, label: 'API Key' },
  { step: 4, label: 'å®‰è£' },
  { step: 5, label: 'å•Ÿå‹•' },
  { step: 6, label: 'Skill' },
];

// Find prev/next articles in path
const prevArticle = stepArticleMap.get(currentStep - 1);
const nextArticle = stepArticleMap.get(currentStep + 1);
---

<nav class="article-progress-bar" aria-label="å…¥é–€è·¯ç·šé€²åº¦">
  <div class="progress-steps">
    {steps.map((s) => {
      const article = stepArticleMap.get(s.step);
      const isCurrent = s.step === currentStep;
      const isPast = s.step < currentStep;
      const available = !!article && !isCurrent;

      return available ? (
        <a
          href={`/articles/${article.id}`}
          class={`progress-step ${isPast ? 'past' : ''}`}
          title={s.label}
        >
          <span class="progress-dot" />
          <span class="progress-label">{s.label}</span>
        </a>
      ) : (
        <div
          class={`progress-step ${isCurrent ? 'current' : ''} ${!article && !isCurrent ? 'future' : ''}`}
          title={s.label}
        >
          <span class="progress-dot" />
          <span class="progress-label">{s.label}</span>
        </div>
      );
    })}
  </div>

  <div class="progress-nav">
    {prevArticle ? (
      <a href={`/articles/${prevArticle.id}`} class="progress-nav-link">
        â† ä¸Šä¸€æ­¥
      </a>
    ) : <span />}
    <span class="progress-current-label">ç¬¬ {currentStep}/6 æ­¥</span>
    {nextArticle ? (
      <a href={`/articles/${nextArticle.id}`} class="progress-nav-link">
        ä¸‹ä¸€æ­¥ â†’
      </a>
    ) : currentStep < 6 ? (
      <span class="text-text-muted text-sm">å³å°‡æ¨å‡º</span>
    ) : (
      <span class="text-text-muted text-sm">ğŸ‰ å®Œæˆï¼</span>
    )}
  </div>
</nav>
